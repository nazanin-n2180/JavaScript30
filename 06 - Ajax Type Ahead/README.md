<div dir="rtl">

# تمرین ۶: پیش‌بینی ورودی (Type Ahead AJAX)

در این تمرین یک صفحه وب داریم که شامل یک عنصر `input` است و کاربر می‌تواند در آن متنی وارد کند. زیر آن نیز یک `unordered list` قرار دارد که باید نام شهرها و ایالت‌هایی را که شامل متن واردشده هستند نمایش دهد و بخش منطبق را هایلایت کند. در حال حاضر، **هیچ‌کدام از این موارد کار نمی‌کنند**.  

در `script` یک ثابت به نام `endpoint` تعریف شده که به مجموعه‌ای از داده‌های JSON اشاره می‌کند. هدف ما این است که با جاوااسکریپت، داده‌ها را از آن آدرس دریافت کرده و قابلیت پیش‌بینی ورودی را پیاده‌سازی کنیم.


## خلاصه

ابتدا یک متغیر تعریف کنید تا آرایه‌ای از داده‌های دریافتی از endpoint را نگه دارد. سپس داده‌ها را با `fetch` دریافت کرده و در این آرایه ذخیره کنید.  
به عنصر `input` یک `event listener` برای رویداد `keyup` اضافه کنید تا هر بار کاربر چیزی تایپ کرد، یک تابع event handler اجرا شود. این تابع وظیفه پردازش داده‌ها و نمایش نتایج را دارد. درون این تابع از یک تابع دیگر کمک می‌گیریم که داده‌ها را با متن ورودی کاربر تطبیق می‌دهد. برای این کار از **عبارت‌های منظم (RegExp)** استفاده خواهیم کرد.


## مراحل پیاده‌سازی

۱. سه متغیر تعریف کنید:
<ul>
   <li> یکی برای نگهداری داده‌های دریافتی از endpoint</li>  
   <li> یکی برای ارجاع به عنصر <code>input</code></li>  
   <li> یکی برای ارجاع به عنصر <code>ul</code></li>
</ul>

۲. از متد `fetch` برای دریافت داده‌ها از endpoint استفاده کنید. `fetch` یک شئ promise برمی‌گرداند که می‌توانیم با <span dir="ltr">`.then()`</span> نتیجه آن را دریافت کنیم. ابتدا پاسخ را با <span dir="ltr">`.json()`</span> به داده قابل استفاده تبدیل کنید و سپس داده‌ها را با استفاده از عملگر spread در آرایه `cities` قرار دهید. توجه کنید که باید از `...` استفاده کنیم؛ چون در غیر این صورت، کل داده‌ها به صورت یک آرایهٔ تودرتو درون `cities` ذخیره می‌شوند.
```javascript
fetch(endpoint)
   .then(prom => prom.json())
   .then(data => cities.push(...data));
```

۳. روی عنصر `input` یک `event listener` اضافه کنید که به رویدادهای `change` و `keyup` گوش کند و یک تابع را به‌عنوان event handler اجرا کند.

۴. یک تابع تعریف کنید که وظیفه تطبیق متن ورودی با داده‌های دریافت‌شده را دارد و در بدنه تابع event handler استفاده می‌شود.
<ul>
   <li> این تابع دو پارامتر می‌گیرد: متن ورودی و آرایه داده‌های دریافتی از endpoint.</li>
   <li> در بدنه تابع، آرایه را با استفاده از یک شئ <code>RegExp</code> جدید فیلتر کنید. این شئ متن ورودی را به عنوان الگویی برای مطابقت می‌پذیرد و دارای پرچم‌هایی خواهد بود که همه تطابق‌ها را پیدا می‌کنند (به‌جای اینکه در اولین تطابق متوقف شوند) و حروف بزرگ و کوچک متن را نادیده می‌گیرند (برای آشنایی با <code>RegExp</code> constructor <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RegExp">اینجا</a> را ببینید).</li>  
   <li> بررسی کنید که متن ورودی در ویژگی‌های <code>city</code> یا <code>state</code> داده‌ها وجود دارد یا خیر.</li>  
</ul>

۵. تابع event handler را تعریف کنید:
<ul>
   <li> ابتدا یک متغیر تعریف کرده و خروجی تابع مرحله ۴ با آرگومان‌های متن ورودی و متغیر حاوی داده‌های endpoint را در آن ذخیره کنید. این متغیر شامل آرایه‌ای از آیتم‌های منطبق با متن ورودی خواهد بود.</li>
   <li> یک متغیر دیگر تعریف کنید که نتیجه استفاده از متد <code>map</code> روی آرایه ذخیره شده در متغیر قبلی را ذخیره کند. در بدنه متد <code>map</code>، دو متغیر جدید تعریف کنید که ویژگی‌های <code>city</code> و <code>state</code> هر شئ‌ای در آرایه که روی آن map انجام می‌شود را هدف قرار داده و بخش منطبق با ورودی را با HTML لازم برای هایلایت کردن آن جایگزین کنید. در نهایت، خروجی در قالب یک <code>template string</code> خواهد بود که شامل دو <code>list item</code> است: یکی برای نمایش نام شهر و ایالت با متغیرهایی که تازه تعریف شده‌اند و دیگری برای نمایش جمعیت.</li>
   <li>برای خواناتر کردن اعداد جمعیت، با استفاده از کاما سه رقم سه رقم آن را تقسیم‌بندی کنید. از تابع زیر استفاده کنید:<br>
   <code><span dir="ltr"><pre>function numberWithCommas(x) {
      return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
   }</pre></span></code></li>
   <li> در پایان، خروجی <code>map</code> آرایه‌ای از template stringها خواهد بود که می‌توان آن‌ها را با <code>join</code> به یک رشته بزرگ تبدیل کنید. با استفاده از متغیر سوم مرحله ۱، innerHTML عنصر <code>ul</code> را برابر متغیر شامل template string بزرگ قرار دهید.</li>
</ul>


---
🎉 چالش ۶ انجام شد!
